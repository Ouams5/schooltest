<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bni Yekhlef High School</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
    body {
        margin: 0;
        font-family: "Poppins", sans-serif;
        background: #f2f4f7;
    }

    /* Notification system */
    #notifBox {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
    }
    .notif {
        background: #333;
        color: white;
        padding: 12px 18px;
        margin-top: 10px;
        border-radius: 6px;
        opacity: 0;
        transform: translateX(30px);
        animation: slideIn 0.4s forwards;
    }
    @keyframes slideIn {
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    /* Login/Register UI */
    .center-box {
        max-width: 350px;
        background: white;
        padding: 30px;
        border-radius: 8px;
        margin: 80px auto;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    input {
        width: 100%;
        padding: 12px;
        margin-top: 10px;
        border: 1px solid #aaa;
        border-radius: 6px;
    }

    button {
        width: 100%;
        margin-top: 15px;
        padding: 12px;
        border: none;
        border-radius: 6px;
        background: #004aad;
        color: white;
        font-weight: 600;
        cursor: pointer;
    }

    /* Admin Panel */
    #adminPanel {
        display: none;
        padding: 20px;
    }

    /* Chat */
    #chatBox {
        width: 100%;
        height: 250px;
        background: #fff;
        border: 1px solid #ccc;
        padding: 10px;
        overflow-y: auto;
        margin-bottom: 10px;
    }

</style>
</head>
<body>

<!-- Notification box -->
<div id="notifBox"></div>

<!-- Login/Register Page -->
<div class="center-box" id="authBox">
<h2 id="schoolName">Bni Yekhlef High School</h2>

<h3 id="authTitle">Login</h3>

<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button onclick="login()">Log In</button>

<button onclick="showRegister()">Create Account</button>
</div>

<!-- Admin Panel -->
<div id="adminPanel">
<h2>Admin Panel</h2>

<h3>Admin Chat</h3>
<div id="chatBox"></div>
<input id="chatInput" placeholder="Type message">
<button onclick="sendMessage()">Send</button>

<br><br>
<button onclick="logout()">Log Out</button>
</div>

<!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
/* -----------------------------
       FIREBASE CONNECT
-------------------------------- */
const firebaseConfig = {
  apiKey: "AIzaSyD6ha3-iiXidoa0KnB9PuA0fnlqDUkcV2g",
  authDomain: "bniyekhlef-high-school.firebaseapp.com",
  projectId: "bniyekhlef-high-school",
  storageBucket: "bniyekhlef-high-school.firebasestorage.app",
  messagingSenderId: "807833913334",
  appId: "1:807833913334:web:a5eb4e2b96c0c32f2169d7",
  measurementId: "G-QCWNGXXRPP"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* -----------------------------
        NOTIFICATION SYSTEM
-------------------------------- */
function notify(msg) {
    const box = document.getElementById("notifBox");
    const div = document.createElement("div");
    div.className = "notif";
    div.innerText = msg;
    box.appendChild(div);

    setTimeout(() => {
        div.style.opacity = "0";
        setTimeout(() => div.remove(), 500);
    }, 3000);
}

/* -----------------------------
         REGISTER SYSTEM
-------------------------------- */
function showRegister() {
    document.getElementById("authTitle").innerText = "Create Account";
    document.querySelector("#authBox button:nth-child(5)").onclick = register;
}

function register() {
    const email = email.value;
    const pass = password.value;

    auth.createUserWithEmailAndPassword(email, pass)
        .then(() => notify("Account created successfully!"))
        .catch(e => notify(e.message));
}

/* -----------------------------
          LOGIN SYSTEM
-------------------------------- */
function login() {
    auth.signInWithEmailAndPassword(email.value, password.value)
        .then(() => notify("Logged in successfully!"))
        .catch(e => notify(e.message));
}

/* -----------------------------
         LOGOUT
-------------------------------- */
function logout() {
    auth.signOut();
    notify("Logged out.");
    location.reload();
}

/* -----------------------------
     AUTH STATE LISTENER
-------------------------------- */
auth.onAuthStateChanged(user => {
    if (user) {
        db.collection("admins").doc(user.uid).get().then(doc => {
            if (doc.exists) {
                // ADMIN LOGGED IN
                document.getElementById("authBox").style.display = "none";
                document.getElementById("adminPanel").style.display = "block";
                notify("Welcome Admin!");
                loadChat();
            } else {
                notify("You are not an admin.");
                auth.signOut();
            }
        });
    }
});

/* -----------------------------
          CHAT SYSTEM
-------------------------------- */
function loadChat() {
    db.collection("chat")
        .orderBy("time")
        .onSnapshot(snap => {
            let html = "";
            snap.forEach(doc => {
                const d = doc.data();
                html += `<p><b>${d.author}:</b> ${d.msg}</p>`;
            });
            document.getElementById("chatBox").innerHTML = html;
        });
}

function sendMessage() {
    if (!chatInput.value) return;
    const user = auth.currentUser;
    db.collection("chat").add({
        msg: chatInput.value,
        author: user.email,
        time: Date.now()
    });
    chatInput.value = "";
}
</script>
</body>
</html>
